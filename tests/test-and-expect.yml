---
- hosts: all
  gather_facts: False

  roles:
  - ansible-smart-ssh-pipelining-role

  tasks:
  - debug: msg="{{ 'post=' + ansible_ssh_pipelining | string }}"
  - assert: { that: "ansible_ssh_pipelining == (expect_pipelining | d(True) | bool)" }
    when:
    - inventory_hostname != 'testserverB'
    - inventory_hostname != 'testserverD'
  - assert: { that: "ansible_ssh_pipelining == True" }
    when: inventory_hostname == 'testserverB'
  - assert: { that: "ansible_ssh_pipelining == False" }
    when: inventory_hostname == 'testserverD'
