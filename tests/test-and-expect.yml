---
- hosts: all
  gather_facts: False

  roles:
  - ansible-smart-ssh-pipelining-role

  tasks:
  - debug: msg="{{ 'post=' + ansible_ssh_pipelining | string }}"

  - assert: { that: "ansible_ssh_pipelining == (expect_pipelining | d(True) | bool)" }
    when: ([inventory_hostname] | intersect(['testserverA', 'testserverC']) | list | length == 1)

  - assert: { that: "ansible_ssh_pipelining == pre_status" }
    when: ([inventory_hostname] | intersect(['testserverB', 'testserverD']) | list | length == 1)
